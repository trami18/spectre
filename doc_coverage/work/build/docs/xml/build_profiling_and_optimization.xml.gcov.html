<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - 6b1f6497bf2e26d1474bfadf143b3321942c40b4 - /work/build/docs/xml/build_profiling_and_optimization.xml</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title"> SpECTRE Documentation Coverage Report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../index.html">top level</a> - <a href="index.html">work/build/docs/xml</a> - build_profiling_and_optimization.xml</td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
             <td class="headerItem">Commit:</td>
             <td class="headerValue"><a target="_blank" href="https://github.com/sxs-collaboration/spectre/commit/6b1f6497bf2e26d1474bfadf143b3321942c40b4">6b1f6497bf2e26d1474bfadf143b3321942c40b4</a></td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2021-04-23 07:10:14</td>
            <td></td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span><span class="lineCov">          1 : &lt;?xml version='1.0' encoding='UTF-8' standalone='no'?&gt;</span></a>
<a name="2"><span class="lineNum">       2 </span>            : &lt;doxygen xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;compound.xsd&quot; version=&quot;1.8.17&quot;&gt;</a>
<a name="3"><span class="lineNum">       3 </span>            :   &lt;compounddef id=&quot;build_profiling_and_optimization&quot; kind=&quot;page&quot;&gt;</a>
<a name="4"><span class="lineNum">       4 </span>            :     &lt;compoundname&gt;build_profiling_and_optimization&lt;/compoundname&gt;</a>
<a name="5"><span class="lineNum">       5 </span>            :     &lt;title&gt;Build Profiling and Optimization&lt;/title&gt;</a>
<a name="6"><span class="lineNum">       6 </span>            :     &lt;tableofcontents&gt;</a>
<a name="7"><span class="lineNum">       7 </span>            :       &lt;tocsect&gt;</a>
<a name="8"><span class="lineNum">       8 </span>            :         &lt;name&gt;Why is our build so expensive?&lt;/name&gt;</a>
<a name="9"><span class="lineNum">       9 </span>            :         &lt;reference&gt;build_profiling_and_optimization_1autotoc_md122&lt;/reference&gt;</a>
<a name="10"><span class="lineNum">      10 </span>            :     &lt;/tocsect&gt;</a>
<a name="11"><span class="lineNum">      11 </span>            :       &lt;tocsect&gt;</a>
<a name="12"><span class="lineNum">      12 </span>            :         &lt;name&gt;Understanding template expenses&lt;/name&gt;</a>
<a name="13"><span class="lineNum">      13 </span>            :         &lt;reference&gt;build_profiling_and_optimization_1autotoc_md123&lt;/reference&gt;</a>
<a name="14"><span class="lineNum">      14 </span>            :     &lt;/tocsect&gt;</a>
<a name="15"><span class="lineNum">      15 </span>            :       &lt;tocsect&gt;</a>
<a name="16"><span class="lineNum">      16 </span>            :         &lt;name&gt;Profiling the build&lt;/name&gt;</a>
<a name="17"><span class="lineNum">      17 </span>            :         &lt;reference&gt;build_profiling_and_optimization_1autotoc_md124&lt;/reference&gt;</a>
<a name="18"><span class="lineNum">      18 </span>            :     &lt;tableofcontents&gt;</a>
<a name="19"><span class="lineNum">      19 </span>            :       &lt;tocsect&gt;</a>
<a name="20"><span class="lineNum">      20 </span>            :         &lt;name&gt;Specialized tests and feature exploration&lt;/name&gt;</a>
<a name="21"><span class="lineNum">      21 </span>            :         &lt;reference&gt;build_profiling_and_optimization_1autotoc_md125&lt;/reference&gt;</a>
<a name="22"><span class="lineNum">      22 </span>            :     &lt;/tocsect&gt;</a>
<a name="23"><span class="lineNum">      23 </span>            :       &lt;tocsect&gt;</a>
<a name="24"><span class="lineNum">      24 </span>            :         &lt;name&gt;Templight++&lt;/name&gt;</a>
<a name="25"><span class="lineNum">      25 </span>            :         &lt;reference&gt;build_profiling_and_optimization_1autotoc_md126&lt;/reference&gt;</a>
<a name="26"><span class="lineNum">      26 </span>            :     &lt;/tocsect&gt;</a>
<a name="27"><span class="lineNum">      27 </span>            :       &lt;tocsect&gt;</a>
<a name="28"><span class="lineNum">      28 </span>            :         &lt;name&gt;Clang AST syntax generation&lt;/name&gt;</a>
<a name="29"><span class="lineNum">      29 </span>            :         &lt;reference&gt;build_profiling_and_optimization_1autotoc_md127&lt;/reference&gt;</a>
<a name="30"><span class="lineNum">      30 </span>            :     &lt;/tocsect&gt;</a>
<a name="31"><span class="lineNum">      31 </span>            :     &lt;/tableofcontents&gt;</a>
<a name="32"><span class="lineNum">      32 </span>            :     &lt;/tocsect&gt;</a>
<a name="33"><span class="lineNum">      33 </span>            :     &lt;/tableofcontents&gt;</a>
<a name="34"><span class="lineNum">      34 </span>            :     &lt;briefdescription&gt;</a>
<a name="35"><span class="lineNum">      35 </span>            :     &lt;/briefdescription&gt;</a>
<a name="36"><span class="lineNum">      36 </span>            :     &lt;detaileddescription&gt;</a>
<a name="37"><span class="lineNum">      37 </span>            : &lt;sect1 id=&quot;build_profiling_and_optimization_1autotoc_md122&quot;&gt;</a>
<a name="38"><span class="lineNum">      38 </span>            : &lt;title&gt;Why is our build so expensive?&lt;/title&gt;</a>
<a name="39"><span class="lineNum">      39 </span>            : &lt;para&gt;SpECTRE makes heavy use of compile-time logic, which is responsible for a lot of the nice type-checking, performance, and flexibility the code has to offer. For instance, our central data structure, the &lt;ref refid=&quot;group__DataBoxGroup&quot; kindref=&quot;compound&quot;&gt;DataBox&lt;/ref&gt;, uses a type list of several &amp;quot;tags&amp;quot; to determine its contents, as well as to automatically propagate dependencies in compute items.&lt;/para&gt;</a>
<a name="40"><span class="lineNum">      40 </span>            : &lt;para&gt;This use of compile-time logic, however, has the trade-off of making our builds take longer and use more memory than a similar implementation in runtime logic would. There is good reason to believe that some of these costs are payed back at runtime, because many of our compile-time switches permit the final runtime code to be more efficient or avoid unnecessary computation. There is certainly room for optimization, though, either in finding better compile-time implementations of the algorithms, eliminating expensive template instantiations, or moving inefficient parts to runtime. This guide gives a quick outline of some of the methods that can be used to profile the build and possible pitfalls&lt;/para&gt;</a>
<a name="41"><span class="lineNum">      41 </span>            : &lt;/sect1&gt;</a>
<a name="42"><span class="lineNum">      42 </span>            : &lt;sect1 id=&quot;build_profiling_and_optimization_1autotoc_md123&quot;&gt;</a>
<a name="43"><span class="lineNum">      43 </span>            : &lt;title&gt;Understanding template expenses&lt;/title&gt;</a>
<a name="44"><span class="lineNum">      44 </span>            : &lt;para&gt;The cost of compile-time template logic is a bit non-intuitive if you are used to thinking only of runtime performance. The main reason is that the typical unit of &amp;apos;cost&amp;apos; in a compile-time operation is the number of instantiated types and functions. Re-using a type that has been instantiated elsewhere (in the same translation unit) typically has a very low compile-time cost, where instantiating a type with new template parameters will incur its own cost, plus any new types that it requires in e.g. type aliases or member functions.&lt;/para&gt;</a>
<a name="45"><span class="lineNum">      45 </span>            : &lt;para&gt;Consider a Fibonacci calculation at compile-time: &lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;template&lt;sp/&gt;&amp;lt;size_t&lt;sp/&gt;N&amp;gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="46"><span class="lineNum">      46 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;struct&lt;sp/&gt;Fibonacci&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="47"><span class="lineNum">      47 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;static&lt;sp/&gt;constexpr&lt;sp/&gt;size_t&lt;sp/&gt;value&lt;sp/&gt;=&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="48"><span class="lineNum">      48 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;Fibonacci&amp;lt;N&lt;sp/&gt;-&lt;sp/&gt;1&amp;gt;::value&lt;sp/&gt;+&lt;sp/&gt;Fibonacci&amp;lt;N&lt;sp/&gt;-&lt;sp/&gt;2&amp;gt;::value;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="49"><span class="lineNum">      49 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="50"><span class="lineNum">      50 </span>            : &lt;codeline&gt;&lt;/codeline&gt;</a>
<a name="51"><span class="lineNum">      51 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;template&lt;sp/&gt;&amp;lt;&amp;gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="52"><span class="lineNum">      52 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;struct&lt;sp/&gt;Fibonacci&amp;lt;1&amp;gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="53"><span class="lineNum">      53 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;static&lt;sp/&gt;constexpr&lt;sp/&gt;size_t&lt;sp/&gt;value&lt;sp/&gt;=&lt;sp/&gt;1;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="54"><span class="lineNum">      54 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="55"><span class="lineNum">      55 </span>            : &lt;codeline&gt;&lt;/codeline&gt;</a>
<a name="56"><span class="lineNum">      56 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;template&lt;sp/&gt;&amp;lt;&amp;gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="57"><span class="lineNum">      57 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;struct&lt;sp/&gt;Fibonacci&amp;lt;0&amp;gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="58"><span class="lineNum">      58 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;static&lt;sp/&gt;constexpr&lt;sp/&gt;size_t&lt;sp/&gt;value&lt;sp/&gt;=&lt;sp/&gt;1;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="59"><span class="lineNum">      59 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="60"><span class="lineNum">      60 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="61"><span class="lineNum">      61 </span>            : &lt;para&gt;If we were to write the same logic at runtime, the algorithm would be hopelessly inefficient; the recursive calls would cause each call to Fibonacci to make two calls to the same function, resulting in an exponential time algorithm! However, the C++ language will only instantiate unique types, so only N types will be created, giving a linear in compile-time operation.&lt;/para&gt;</a>
<a name="62"><span class="lineNum">      62 </span>            : &lt;para&gt;Compile-time lists and list operations frequently appear in SpECTRE, and should be thought of differently from runtime list operations.&lt;/para&gt;</a>
<a name="63"><span class="lineNum">      63 </span>            : &lt;para&gt;In compile-time lists, we have no access to true constant-time lookup, speedy algorithms that rely on sorted structures, or more sophisticated data structures (balanced trees, hash tables, etc.). The limitations of compile-time list techniques can cause list operations to be more costly than we could achieve with runtime data structures.&lt;/para&gt;</a>
<a name="64"><span class="lineNum">      64 </span>            : &lt;para&gt;Consider a basic version of the compile-time list accessor: &lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;template&lt;sp/&gt;&amp;lt;typename&lt;sp/&gt;List,&lt;sp/&gt;size_t&lt;sp/&gt;Index&amp;gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="65"><span class="lineNum">      65 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;struct&lt;sp/&gt;list_at;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="66"><span class="lineNum">      66 </span>            : &lt;codeline&gt;&lt;/codeline&gt;</a>
<a name="67"><span class="lineNum">      67 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;template&lt;sp/&gt;&amp;lt;typename&lt;sp/&gt;ListItem0,&lt;sp/&gt;typename...&lt;sp/&gt;ListItems&amp;gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="68"><span class="lineNum">      68 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;struct&lt;sp/&gt;list_at&amp;lt;tmpl::list&amp;lt;ListItem0,&lt;sp/&gt;ListItems...&amp;gt;,&lt;sp/&gt;0&amp;gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="69"><span class="lineNum">      69 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;using&lt;sp/&gt;type&lt;sp/&gt;=&lt;sp/&gt;ListItem0;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="70"><span class="lineNum">      70 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="71"><span class="lineNum">      71 </span>            : &lt;codeline&gt;&lt;/codeline&gt;</a>
<a name="72"><span class="lineNum">      72 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;template&lt;sp/&gt;&amp;lt;typename&lt;sp/&gt;ListItem0,&lt;sp/&gt;typename...&lt;sp/&gt;ListItems,&lt;sp/&gt;size_t&lt;sp/&gt;Index&amp;gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="73"><span class="lineNum">      73 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;struct&lt;sp/&gt;list_at&amp;lt;tmpl::list&amp;lt;ListItem0,&lt;sp/&gt;ListItems...&amp;gt;,&lt;sp/&gt;Index&amp;gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="74"><span class="lineNum">      74 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;using&lt;sp/&gt;type&lt;sp/&gt;=&lt;sp/&gt;typename&lt;sp/&gt;list_at&amp;lt;tmpl::list&amp;lt;ListItems...&amp;gt;,&lt;sp/&gt;Index&lt;sp/&gt;-&lt;sp/&gt;1&amp;gt;::type;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="75"><span class="lineNum">      75 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="76"><span class="lineNum">      76 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="77"><span class="lineNum">      77 </span>            : &lt;para&gt;Now, to access the Nth item in the list, we need to instantiate &lt;formula id=&quot;2740&quot;&gt;$O(N)$&lt;/formula&gt; types. The above implementation is significantly more costly than we would find in practice in template metaprogramming libraries &lt;ndash/&gt; in particular, our chosen TMPL backend, &lt;ulink url=&quot;https://github.com/edouarda/brigand&quot;&gt;Brigand&lt;/ulink&gt;, manages the task in &lt;formula id=&quot;2741&quot;&gt;$O(\log(N))$&lt;/formula&gt; (at least in type instantiation count).&lt;/para&gt;</a>
<a name="78"><span class="lineNum">      78 </span>            : &lt;para&gt;Most of the list operations in SpECTRE cannot take advantage of any particular ordering or hashing of the list, so must resort to naive list operations &lt;ndash/&gt; so, searching a list (&lt;computeroutput&gt;tmpl::list_contains&lt;/computeroutput&gt; or &lt;computeroutput&gt;tmpl::index_of&lt;/computeroutput&gt;) is &lt;formula id=&quot;2740&quot;&gt;$O(N)$&lt;/formula&gt; cost, &lt;computeroutput&gt;tmpl::remove_duplicates&lt;/computeroutput&gt; is &lt;formula id=&quot;2742&quot;&gt;$O(N^2)$&lt;/formula&gt;, and &lt;computeroutput&gt;tmpl::list_difference&lt;/computeroutput&gt; is similarly &lt;formula id=&quot;2742&quot;&gt;$O(N^2)$&lt;/formula&gt;. So, complicated type logic scales pretty badly with long lists, and improvements can sometimes be made by reducing a list&amp;apos;s size or avoiding the more costly list operations when a list is known to be long.&lt;/para&gt;</a>
<a name="79"><span class="lineNum">      79 </span>            : &lt;/sect1&gt;</a>
<a name="80"><span class="lineNum">      80 </span>            : &lt;sect1 id=&quot;build_profiling_and_optimization_1autotoc_md124&quot;&gt;</a>
<a name="81"><span class="lineNum">      81 </span>            : &lt;title&gt;Profiling the build&lt;/title&gt;</a>
<a name="82"><span class="lineNum">      82 </span>            : &lt;para&gt;In the current version of SpECTRE, the most expensive builds are the final translation units associated with the executables (particularly the most complicated executables, like Generalized Harmonic and Valencia), which should be unsurprising from the above discussion: it is in these compilation steps that we instantiate the &lt;ref refid=&quot;namespaceParallel&quot; kindref=&quot;compound&quot;&gt;Parallel&lt;/ref&gt; components, and in turn, all of the &lt;ref refid=&quot;group__DataBoxGroup&quot; kindref=&quot;compound&quot;&gt;DataBox&lt;/ref&gt; types that will be used during the evolution.&lt;/para&gt;</a>
<a name="83"><span class="lineNum">      83 </span>            : &lt;para&gt;Similarly, a number of tests have now shown that in the current version of SpECTRE (as of early 2021), by far the most expensive part of the build is &lt;ref refid=&quot;group__DataBoxGroup&quot; kindref=&quot;compound&quot;&gt;DataBox&lt;/ref&gt; operations and instantiations, and the best build performance gains are available by either reducing the number of &lt;ref refid=&quot;group__DataBoxGroup&quot; kindref=&quot;compound&quot;&gt;DataBox&lt;/ref&gt;es that are instantiated, reducing the number of tags (particularly compute tags) stored in the &lt;ref refid=&quot;group__DataBoxGroup&quot; kindref=&quot;compound&quot;&gt;DataBox&lt;/ref&gt;, or optimizing the implementations of the &lt;ref refid=&quot;group__DataBoxGroup&quot; kindref=&quot;compound&quot;&gt;DataBox&lt;/ref&gt; and its utilities. So, generally speaking, profiling should start by focusing on the &lt;ref refid=&quot;group__DataBoxGroup&quot; kindref=&quot;compound&quot;&gt;DataBox&lt;/ref&gt;, and move to other utilities if it becomes clear that there are other parts of the code that are contributing significantly to the compilation time or memory usage.&lt;/para&gt;</a>
<a name="84"><span class="lineNum">      84 </span>            : &lt;sect2 id=&quot;build_profiling_and_optimization_1autotoc_md125&quot;&gt;</a>
<a name="85"><span class="lineNum">      85 </span>            : &lt;title&gt;Specialized tests and feature exploration&lt;/title&gt;</a>
<a name="86"><span class="lineNum">      86 </span>            : &lt;para&gt;This is simultaneously the most reliable and most labor-intensive strategy for understanding build costs. The procedure is to identify a feature you&amp;apos;d like to profile, create a specialized test for that feature, and put that test in the &lt;computeroutput&gt;tests/Unit/RunSingleTest/CMakeLists.txt&lt;/computeroutput&gt;. Then, you can easily include or exclude uses of functions or classes that you want to profile, and compare the relative total cost of building &lt;computeroutput&gt;RunSingleTest&lt;/computeroutput&gt;.&lt;/para&gt;</a>
<a name="87"><span class="lineNum">      87 </span>            : &lt;para&gt;There are a number of tools for profiling the cost of an individual process, but for compilation, the detailed tools like &lt;computeroutput&gt;perf&lt;/computeroutput&gt; or hpctoolkit are unlikely to give useful information about what parts of our code are slow to build. Instead, it&amp;apos;s best to just carefully measure the full build of the target in question, and rapidly iterate to include or exclude potentially expensive parts to understand the build costs.&lt;/para&gt;</a>
<a name="88"><span class="lineNum">      88 </span>            : &lt;para&gt;There are a lot of tools that can give you the global resource usage information, including the &lt;computeroutput&gt;/proc/$PID/status&lt;/computeroutput&gt; file from kernel information, &lt;computeroutput&gt;top&lt;/computeroutput&gt;, or tools from the &lt;computeroutput&gt;sysstat&lt;/computeroutput&gt; package. The &lt;computeroutput&gt;time&lt;/computeroutput&gt; utility is particularly user-friendly, available on ubuntu (and therefore in the SpECTRE build container) via &lt;computeroutput&gt;apt-get install time&lt;/computeroutput&gt;. Then, it can be invoked by &lt;computeroutput&gt;/usr/bin/time -v your_command&lt;/computeroutput&gt; (note that simply &lt;computeroutput&gt;time&lt;/computeroutput&gt; will route to a different alias in the default environment on ubuntu in the container, so the full path &lt;computeroutput&gt;/usr/bin/time&lt;/computeroutput&gt; is required). After completion, it will print a readable report of the time and memory usage.&lt;/para&gt;</a>
<a name="89"><span class="lineNum">      89 </span>            : &lt;para&gt;One important feature to be aware of in profiling the build by this method is the implicit memoization of many compile-time features. For instance, if feature &lt;computeroutput&gt;A&lt;/computeroutput&gt; and &lt;computeroutput&gt;B&lt;/computeroutput&gt; both instantiate a class &lt;computeroutput&gt;C&lt;/computeroutput&gt; that is expensive to build, you&amp;apos;ll see a difference in the build cost when &lt;emphasis&gt;either&lt;/emphasis&gt; &lt;computeroutput&gt;A&lt;/computeroutput&gt; or &lt;computeroutput&gt;B&lt;/computeroutput&gt; are included, but the cost won&amp;apos;t be additive - the second feature will just &amp;apos;reuse&amp;apos; the instantiation from the first. To optimize this type of situation, either &lt;computeroutput&gt;C&lt;/computeroutput&gt; must be improved to be less costly to instantiate, or its use must be eliminated from &lt;emphasis&gt;both&lt;/emphasis&gt; &lt;computeroutput&gt;A&lt;/computeroutput&gt; and &lt;computeroutput&gt;B&lt;/computeroutput&gt; &lt;ndash/&gt; removing &lt;computeroutput&gt;C&lt;/computeroutput&gt; from only one of the classes that use it won&amp;apos;t help the build much at all.&lt;/para&gt;</a>
<a name="90"><span class="lineNum">      90 </span>            : &lt;/sect2&gt;</a>
<a name="91"><span class="lineNum">      91 </span>            : &lt;sect2 id=&quot;build_profiling_and_optimization_1autotoc_md126&quot;&gt;</a>
<a name="92"><span class="lineNum">      92 </span>            : &lt;title&gt;Templight++&lt;/title&gt;</a>
<a name="93"><span class="lineNum">      93 </span>            : &lt;para&gt;Detailed profiling of a C++ build is a surprisingly hard task, and there are few useful tools for getting a good idea for what parts of a compilation are expensive. One tool that can perform some profiling of the build is &lt;ulink url=&quot;https://github.com/mikael-s-persson/templight&quot;&gt;templight++&lt;/ulink&gt;. &lt;emphasis&gt;It is important to note that this tool often produces build profiles that are misleading or incomplete!&lt;/emphasis&gt; It is included in this guide under the philosophy that a flawed tool can be better than no tool at all in some circumstances, but the templight++ profiles should be taken primarily as a loose guide for features to investigate with more careful follow-up investigations like the above suggestion of specialized tests and feature exploration.&lt;/para&gt;</a>
<a name="94"><span class="lineNum">      94 </span>            : &lt;para&gt;The &lt;computeroutput&gt;templight++&lt;/computeroutput&gt; build and usage instructions work nicely with the current SpECTRE build system, and the cmake trick suggested by the &lt;computeroutput&gt;templight++&lt;/computeroutput&gt; documentation &lt;programlisting filename=&quot;.bash&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;export&lt;sp/&gt;CC=&amp;quot;/path/to/llvm/build/bin/templight&lt;sp/&gt;-Xtemplight&lt;sp/&gt;-profiler\&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="95"><span class="lineNum">      95 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;-Xtemplight&lt;sp/&gt;-memory&amp;quot;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="96"><span class="lineNum">      96 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;export&lt;sp/&gt;CXX=&amp;quot;/path/to/llvm/build/bin/templight++&lt;sp/&gt;-Xtemplight&lt;sp/&gt;-profiler\&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="97"><span class="lineNum">      97 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;-Xtemplight&lt;sp/&gt;-memory&amp;quot;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="98"><span class="lineNum">      98 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="99"><span class="lineNum">      99 </span>            : &lt;para&gt;works well in SpECTRE. Build profiling with &lt;computeroutput&gt;templight++&lt;/computeroutput&gt; are incredibly slow, and seem to produce increasingly misleading data for larger builds, so it is recommended to avoid using the tool for our most expensive evolution executables. Experience indicates that you will likely wait for hours and be disappointed by deeply flawed results.&lt;/para&gt;</a>
<a name="100"><span class="lineNum">     100 </span>            : &lt;para&gt;After building a target, you will find along side each &lt;computeroutput&gt;.o&lt;/computeroutput&gt; file in the &lt;computeroutput&gt;build/src&lt;/computeroutput&gt; tree an additional file that ends with &lt;computeroutput&gt;.trace.pbf&lt;/computeroutput&gt;. These are the &lt;computeroutput&gt;templight++&lt;/computeroutput&gt; trace files, and (like many performance tool outputs), require post-processing to recover human-readable data. The companion package &lt;ulink url=&quot;https://github.com/mikael-s-persson/templight-tools&quot;&gt;templight-tools&lt;/ulink&gt; can be built to obtain the &lt;computeroutput&gt;templight-convert&lt;/computeroutput&gt; utility that converts the templight traces to more managable formats. It is recommended to install and use &lt;ulink url=&quot;https://kcachegrind.github.io/html/Home.html&quot;&gt;KCacheGrind&lt;/ulink&gt; (which does, unfortunately require some KDE libraries, but doesn&amp;apos;t require you to use the full KDE window system) to visualize the output &lt;ndash/&gt; the larger graphs produced by templight are inefficient to render in the graphviz format.&lt;/para&gt;</a>
<a name="101"><span class="lineNum">     101 </span>            : &lt;/sect2&gt;</a>
<a name="102"><span class="lineNum">     102 </span>            : &lt;sect2 id=&quot;build_profiling_and_optimization_1autotoc_md127&quot;&gt;</a>
<a name="103"><span class="lineNum">     103 </span>            : &lt;title&gt;Clang AST syntax generation&lt;/title&gt;</a>
<a name="104"><span class="lineNum">     104 </span>            : &lt;para&gt;There is a nice and poorly documented feature of the &lt;computeroutput&gt;clang++&lt;/computeroutput&gt; compiler that it can produce a rough approximation of the collection of C++ template instantiations produced by a particular executable. Adding &lt;computeroutput&gt;-Xclang -ast-print -fsyntax-only&lt;/computeroutput&gt; to the &lt;computeroutput&gt;CXX_FLAGS&lt;/computeroutput&gt; will cause this information to be printed to stdout, which should probably be redirected to file because it will be an enormous output. Importantly, to the best of our knowledge, this tool has not yet been used to successfully profile any SpECTRE build, but with sufficient post-processing the C++-syntax version of the AST might be useful to determine the number and nature of instantiations produced by a particular piece of code, and might offer some proxy for build performance.&lt;/para&gt;</a>
<a name="105"><span class="lineNum">     105 </span>            : &lt;para&gt;For instance, if we put the above &lt;computeroutput&gt;Fibonacci&lt;/computeroutput&gt; struct in a source file with: &lt;programlisting filename=&quot;.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;int&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;main(&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;int&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;argc,&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;char&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;**&lt;sp/&gt;argv)&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="106"><span class="lineNum">     106 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;ref refid=&quot;cpp/io/cout&quot; kindref=&quot;compound&quot; external=&quot;/__w/spectre/spectre/docs/config/cppreference-doxygen-web.tag.xml&quot;&gt;std::cout &amp;lt;&amp;lt; Fibonacci&amp;lt;6&amp;gt;::value&lt;/ref&gt;&lt;sp/&gt;&amp;lt;&amp;lt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;\n&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="107"><span class="lineNum">     107 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;}&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="108"><span class="lineNum">     108 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="109"><span class="lineNum">     109 </span>            : &lt;para&gt;and we compile it with &lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;clang++-10&lt;sp/&gt;-Xclang&lt;sp/&gt;-ast-print&lt;sp/&gt;-fsyntax-only&lt;sp/&gt;-o&lt;sp/&gt;fib&lt;sp/&gt;./fib.cpp&lt;sp/&gt;&amp;gt;&amp;gt;&lt;sp/&gt;fib_out&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="110"><span class="lineNum">     110 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="111"><span class="lineNum">     111 </span>            : &lt;para&gt;we obtain in &lt;computeroutput&gt;fib_out&lt;/computeroutput&gt; (after thousands of lines of STL-generated code): &lt;programlisting filename=&quot;.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;keyword&quot;&gt;template&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&amp;lt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;size_t&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;N&amp;gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;struct&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;Fibonacci&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="112"><span class="lineNum">     112 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;static&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;constexpr&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;size_t&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;value&lt;sp/&gt;=&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="113"><span class="lineNum">     113 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;Fibonacci&amp;lt;N&lt;sp/&gt;-&lt;sp/&gt;1&amp;gt;::value&lt;sp/&gt;+&lt;sp/&gt;Fibonacci&amp;lt;N&lt;sp/&gt;-&lt;sp/&gt;2&amp;gt;::value;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="114"><span class="lineNum">     114 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="115"><span class="lineNum">     115 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;template&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&amp;lt;&amp;gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;struct&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;Fibonacci&amp;lt;6&amp;gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="116"><span class="lineNum">     116 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;static&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;constexpr&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;size_t&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;value&lt;sp/&gt;=&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="117"><span class="lineNum">     117 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;Fibonacci&amp;lt;6UL&lt;sp/&gt;-&lt;sp/&gt;1&amp;gt;::value&lt;sp/&gt;+&lt;sp/&gt;Fibonacci&amp;lt;6UL&lt;sp/&gt;-&lt;sp/&gt;2&amp;gt;::value;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="118"><span class="lineNum">     118 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="119"><span class="lineNum">     119 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;template&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&amp;lt;&amp;gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;struct&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;Fibonacci&amp;lt;5&amp;gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="120"><span class="lineNum">     120 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;static&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;constexpr&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;size_t&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;value&lt;sp/&gt;=&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="121"><span class="lineNum">     121 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;Fibonacci&amp;lt;5UL&lt;sp/&gt;-&lt;sp/&gt;1&amp;gt;::value&lt;sp/&gt;+&lt;sp/&gt;Fibonacci&amp;lt;5UL&lt;sp/&gt;-&lt;sp/&gt;2&amp;gt;::value;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="122"><span class="lineNum">     122 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="123"><span class="lineNum">     123 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;template&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&amp;lt;&amp;gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;struct&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;Fibonacci&amp;lt;4&amp;gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="124"><span class="lineNum">     124 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;static&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;constexpr&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;size_t&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;value&lt;sp/&gt;=&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="125"><span class="lineNum">     125 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;Fibonacci&amp;lt;4UL&lt;sp/&gt;-&lt;sp/&gt;1&amp;gt;::value&lt;sp/&gt;+&lt;sp/&gt;Fibonacci&amp;lt;4UL&lt;sp/&gt;-&lt;sp/&gt;2&amp;gt;::value;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="126"><span class="lineNum">     126 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="127"><span class="lineNum">     127 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;template&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&amp;lt;&amp;gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;struct&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;Fibonacci&amp;lt;3&amp;gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="128"><span class="lineNum">     128 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;static&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;constexpr&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;size_t&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;value&lt;sp/&gt;=&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="129"><span class="lineNum">     129 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;Fibonacci&amp;lt;3UL&lt;sp/&gt;-&lt;sp/&gt;1&amp;gt;::value&lt;sp/&gt;+&lt;sp/&gt;Fibonacci&amp;lt;3UL&lt;sp/&gt;-&lt;sp/&gt;2&amp;gt;::value;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="130"><span class="lineNum">     130 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="131"><span class="lineNum">     131 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;template&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&amp;lt;&amp;gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;struct&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;Fibonacci&amp;lt;2&amp;gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="132"><span class="lineNum">     132 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;static&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;constexpr&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;size_t&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;value&lt;sp/&gt;=&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="133"><span class="lineNum">     133 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;Fibonacci&amp;lt;2UL&lt;sp/&gt;-&lt;sp/&gt;1&amp;gt;::value&lt;sp/&gt;+&lt;sp/&gt;Fibonacci&amp;lt;2UL&lt;sp/&gt;-&lt;sp/&gt;2&amp;gt;::value;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="134"><span class="lineNum">     134 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="135"><span class="lineNum">     135 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;template&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&amp;lt;&amp;gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;struct&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;Fibonacci&amp;lt;1&amp;gt;&lt;sp/&gt;{&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;static&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;constexpr&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;size_t&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;value&lt;sp/&gt;=&lt;sp/&gt;1;&lt;sp/&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="136"><span class="lineNum">     136 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;template&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&amp;lt;&amp;gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;struct&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;Fibonacci&amp;lt;0&amp;gt;&lt;sp/&gt;{&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;static&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;constexpr&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;size_t&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;value&lt;sp/&gt;=&lt;sp/&gt;1;&lt;sp/&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="137"><span class="lineNum">     137 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;int&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;main(&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;int&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;argc,&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;char&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;**argv)&lt;sp/&gt;{&lt;sp/&gt;&lt;ref refid=&quot;cpp/io/cout&quot; kindref=&quot;compound&quot; external=&quot;/__w/spectre/spectre/docs/config/cppreference-doxygen-web.tag.xml&quot;&gt;std::cout &amp;lt;&amp;lt; Fibonacci&amp;lt;6&amp;gt;::value&lt;/ref&gt;&lt;sp/&gt;&amp;lt;&amp;lt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;\n&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;;&lt;sp/&gt;}&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="138"><span class="lineNum">     138 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="139"><span class="lineNum">     139 </span>            : &lt;para&gt;Which is actually pretty illuminating about what the compiler decided to do in this simple case. Unfortunately, the AST produced by &lt;computeroutput&gt;clang++&lt;/computeroutput&gt; in more complicated cases produces extremely large outputs, so realistic cases are likely too large to be usefully human-readable. It may be possible, though, to script post-processing tools to sift through the collections of template instantiations for particular classes to understand specific cases of template logic. &lt;/para&gt;</a>
<a name="140"><span class="lineNum">     140 </span>            : &lt;/sect2&gt;</a>
<a name="141"><span class="lineNum">     141 </span>            : &lt;/sect1&gt;</a>
<a name="142"><span class="lineNum">     142 </span>            :     &lt;/detaileddescription&gt;</a>
<a name="143"><span class="lineNum">     143 </span>            :   &lt;/compounddef&gt;</a>
<a name="144"><span class="lineNum">     144 </span>            : &lt;/doxygen&gt;</a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.14</a></td></tr>
  </table>
  <br>

</body>
</html>
